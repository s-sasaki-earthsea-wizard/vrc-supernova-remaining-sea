# 全ソートアルゴリズム入場！地下ソート場最大トーナメント！
## 発表原稿

[cheerful] 皆さん、こんにちは。本日は貴重なお時間をいただき、ありがとうございます。

[excited] 今日は「全ソートアルゴリズム入場！地下ソート場最大トーナメント！」というテーマで、
「最強」のソートアルゴリズムについてお話しします。
[playful] バキのパロディを交えながら、技術的な内容を楽しく学んでいただければ嬉しいです。
[apologetic] バキを知らない人はごめんなさい！

### 自己紹介

[friendly] まず簡単に自己紹介をさせていただきます。私はさめ（мег-сск）と申します。フリーランスのソフトウェアエンジニアとして活動しており、現在は社会人学生として通信制大学にも在学中です。

[confident] 得意分野はコンピュータビジョン、特に画像認識や点群処理、そして空間情報処理では地理情報やリモートセンシングを扱っています。また、AWSやGCPを使ったクラウドインフラの設計やIaCにも携わっています。

### 今日お話しすること

[enthusiastic] 今日は「最強のソートアルゴリズム」を決める「地下ソート場最大トーナメント」を開催します！
様々なソートアルゴリズムたちの戦いと、トーナメントの意外な決着をぜひ見届けてください！
[thoughtful] そして、そもそも「最強」とは何なのかについても考えていきたいと思います。
[satisfied] ネタのように見えて、意外と深いテーマになっていると思います。

### ソートとは

[explanatory] まずソートとは何か？というところから説明しましょう。
ソートとは、データを特定の順序に並べ替えることです。
この例のように、順番がバラバラな数列を、1,3,4,5,5のように小さい順に並べ替えることがその一例です。
[impressed] 人類は長い間研鑽を積み、様々なソートアルゴリズムを開発してきました。

### 代表的なソートアルゴリズム

[informative] 代表的なソートアルゴリズムには、マージソート、クイックソート、ヒープソートなどがあります。
[curious] こんなにたくさんのアルゴリズムがあるのを見ると、誰もが一度は考えたことがあるのではないでしょうか？
「最強のソートアルゴリズム」は誰なのか、と。

[dramatic] 今日、その疑問に答えるため、「最強のソートアルゴリズム」を決めるトーナメントを開催いたします！

## 全アルゴリズム入場！

[announcing] というわけで、全アルゴリズム入場！

### クイックソート

[intense] 「ピボット選択は生きていた！！更なる分割を積みインプレース凶器が甦った！！！武神！！クイックソートだァ――――！！！」

### ヒープソート

[fierce] 「並べたいからここまできたッ　最初の考案者は不明！！！！完全二分木のピットファイター　ヒープソートだ！！！」

### ティムソート

[passionate] 「Pythonistの前でならオレはいつでも全盛期だ！！燃える闘魂　ティム・ピーターズのティムソート　本名で登場だ！！！」

### マージソート

[powerful] 「めい土の土産にメモリーとはよく言ったもの！！フォン・ノイマンの奥義が今　実戦でバクハツする！！　ロスアラモス流ソート術　マージソートだ―――！！！」

### イントロソート

[confident] 「ソートは実装で使えてナンボのモン！！！　超実戦C++術！！本家STLからイントロソートの登場だ！！！」


### シェルソート

[proud] 「挿入ソートだったらこのアルゴリズムを外せない！！　超Ａ級ソート師　シェルソートだ！！！」


### スムースソート

[mysterious] 「ほとんどソート済みの数列のソートはこのアルゴリズムが完成させた！！ダイクストラの切り札！！　スムースソートだ！！！」


### ペーシェンスソート

[ancient] 「ソリティア四千年の歴史が今ベールを脱ぐ！！　最長増加部分列から　ペーシェンスソートだ！！！」

### ベルト争奪戦開始！

[announcing] 以上、8名の選手によってベルト争奪戦を行います！

## 地下ソート場最大トーナメントの意外な決着

[suspenseful] さあ、いよいよトーナメントの開始です。
[dramatic_pause] ...しかしこの戦いは意外な決着を迎えます！

### 全員引き分け、全員優勝！

[surprised] なんと、全試合が引き分けとなり、全員優勝という結果になりました！

[amused] これは格闘漫画だったら読者からのブーイング必須な結果ですが、なぜこのような結果になってしまったのでしょうか？

## ソートアルゴリズムの理論下限

[serious] 実は、ソートアルゴリズムには「これ以上速くできない」という理論下限が存在します。
そして、今日の選手はすべてこの理論下限に達していたのです。
[metaphorical] 言うなれば出場選手が全員勇次郎だった、みたいなものですね。

### なぜ理論下限が存在するのか

[curious] ではなぜソートには限界があるのでしょう？
[educational] それを詳しくみていきましょう。

### すべての並び替えの組み合わせの数

[explanatory] n個の数値を並び替える組み合わせの数は、nの階乗通りあります。この中からたった一つの正解を見つける必要があるのです。

### 二分木の高さと葉の数

[technical] 比較に基づくソートアルゴリズムは、本質的に二分木として表現できます。
二分木の高さをhとすると、最大で2のh乗個の並べ替えの組み合わせを区別できます。

### 必要な木の高さは？

[logical] ここまでの議論を整理すると、
すべての数字の並びを比較するには、nの階乗が2のh乗以下である、ということが必要となることがわかると思います。

### スターリングの公式

[informative] ここでスターリングの公式という、階乗を近似するための便利な公式を使います。

スターリングの公式を使うと、nの階乗をこのような式で近似できます。
このグラフを見ると、nが十分に大きければ両者はほとんど一致する、ということがよくわかると思います。

### 木の高さを求める不等式

[instructional] スターリングの公式を適用してさっきの不等式の左辺を近似して計算していきます。
[encouraging] 確認したい人は動画を一時停止して、鉛筆を持って計算してみてください。

### さらに計算していく

[methodical] この式をさらに計算してくと、最終的にこのような3つの項の和で表される式になります。
ここから先は、この式の計算量を議論していきましょう。

### 数学的補足

[educational] 計算量の議論をする前に、計算量の表現記法を紹介しておきます。
ビッグオーは上界で、必要な計算量の上限です。これよりも大きくなることはない、という意味ですね。
オメガは下界で、最低でもこれ以上計算を減らすことはできない、という意味です。
上界と下界が一致する場合はシータで書きます。

### オーダーの比較

[analytical] さっきの式の3つの項のうち、
この中で最も大きな項は n log2 nです。
なので、log2 n階乗の中で最も影響力が強い項はn log2 nになり、
これによって最低でも絶対に計算しなければいけない計算量が決まります

### 数列をソートするのに必要な木の高さは？

[addressing_concern] ここで色々な近似をしているから厳密には計算量は違うのではないか？
という疑問が湧いてくるかもしれませんが、計算量の下界という観点からは厳密に等号が成り立ちます。
[satisfied] これが計算量の上界、下界を表す記号であるビッグオーやオメガを用いることのご利益です。

### ソートの理論下限

[emphatic] つまり、どんなにソートの計算を効率化しても、オメガのnログnの計算量は避けられません。
これが理論上最速であり、これ以上に速い「汎用的」なソートアルゴリズムは存在しないのです。

### 今日の選手たちの計算量

[revealing] 今日の選手たちの平均計算量を見てみると、
クイックソートもヒープソートもマージソートも、その他の選手も皆、平均計算量が理論下限のビッグオーn log nに達していました。
だから全員引き分けの全員優勝となったのです。

## 各アルゴリズムの得意・不得意

[transitional] しかし、それぞれのアルゴリズムには得意・不得意があります。

### クイックソート

[informative] クイックソートの平均計算量はビッグオーのnログnですが、最悪計算量はビッグオーのn二乗です。
長所は追加メモリ不要なインプレースなアルゴリズムであることですが、
短所は最悪計算量がビッグオーのn二乗になることです。逆順に並んでいる場合など、特定の入力で性能が劣化します。

### ヒープソート

[balanced] ヒープソートは平均・最悪計算量ともにビッグオーのnログnです。
長所は最悪計算量が保証されていることとインプレースであることですが、短所はタスクの分割がしにくく並列化が難しいことです。

### マージソート

[explaining] マージソートは平均・最悪計算量ともにビッグオーのnログnです。
長所は最悪計算量が保証されていることですが、短所は追加でビッグオーのnのメモリが必要なことです。
これはマージソートが分割して並べ替えて、その後結合する、という操作を繰り返すため、
もともとの数列の他にもうひとつの数列を覚えておく必要があることに由来します。

### ソートアルゴリズムの使い分け

[practical] 実際の使い分けとしてはクイックソートは多くの言語の標準として使われています。
最悪計算量が保証されているマージソートは安定性が必要な局面で力を発揮するでしょう。
リアルタイム性を重視するなら、最悪計算量が保証されていて、なおかつ追加メモリを必要としないヒープソートが強いです。組み込みのように計算資源が限られている場合には特に力を発揮するということですね。

### 特定条件下で強いアルゴリズム

[acknowledging] 平均パフォーマンスでは今日のトーナメント出場選手たちに劣るものの、特定条件下ではより高速なアルゴリズムも存在します：

基数ソートは入力データのフォーマットが限定されている場合に有効ですし、
カウンティングソートは値の範囲が小さい場合に力を発揮します。
入力データが一様分布している場合にバケットソートはとんでもなく早くなります。

[emphasizing] これらのアルゴリズムは汎用性では今日のトーナメントの出場選手たちに劣るものの、
特定の状況ではめちゃくちゃ強くなる、という局面を適切に選べば大活躍してくれるアルゴリズムということです。

## まとめ

[conclusive] 結論として、ソートアルゴリズムに「最強」は存在しません。
それぞれに得意・不得意があり、「最適」があるのみです。
汎用的にはパフォーマンスが劣っていても、特定条件下では圧倒的に強くなるアルゴリズムもあります。
[amused] 公園では最強になる本部以蔵のようなものですね。

[warm] 「みんなちがって、みんないい」という言葉がありますが、まさにソートアルゴリズムもそうです。
それぞれの特性を把握して、状況に応じた適切なアルゴリズムを選ぶことが重要なのです。

### おまけ

[stern] ただしバブルソート、テメーはダメだ。
「最強」は存在しないと言いましたが、明確な悪手は存在します。
バブルソートはわかりやすくて初心者向け、ということ以外に本当に褒めるところがありません。
[warning] 実戦に連れていくのはやめましょう。

### クロージング

[warm] 今日はバキのパロディを交えつつ、ソートアルゴリズムの理論下限についてお話ししました。
最初は半分ふざけて作ったネタだったのですが、思いがけず「最強」とは何か、
という素朴な疑問を考え直すきっかけになってしまったことに自分でも驚いています。

[gentle] これからもこのチャンネルでは、科学や技術の面白さをバーチャルの世界から伝えていこうと思います。
[farewell] それではみなさん、次回の動画までごきげんよう。
